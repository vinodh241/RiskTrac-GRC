<div class="tab-content topTabContentBg h-9 mx-3">
  <div class="p-1 text-center position-relative h-100 d-flex align-items-center justify-content-start"
    id="nav-bcmsTestDetails" aria-labelledby="nav-bcmsTesting-tab">
    <button mat-raised-button color="primary" id="backButton" class="me-3"
      style="display:inline-block; padding:0vh 1vh;border-radius:100vw;margin: 7px 6px;" matTooltip="Navigate back"
      (click)="navigateToTestBCMData()">
      <span style="font-size:16px; margin-right:10px;">&#11164;</span>{{ 'common.back' | translate }}
    </button>
    <div class="navtabHeading me-5" style="margin: 0.8vw; width: 25vw;" [matTooltip]="BCMSTest?.TestName?.length > 100? BCMSTest?.TestName:''">{{service.getTitleValue(BCMSTest?.TestName)}}</div>
    <div class="ms-5 me-3">
      <span class="statusID px-1 statusStyle"
        [ngClass]="(BCMSTest?.TestAssessmentStatusID == 1) ? 'statusScheduled' : (BCMSTest?.TestAssessmentStatusID == 2) ? 'statusInprogress' : (BCMSTest?.TestAssessmentStatusID == 3) ? 'statusCompleted' : 'statusPublished'">{{BCMSTest?.TestAssessmentStatus}}</span>
    </div>
  </div>
</div>

<div class="table-model-bg h-80 px-3 w-100 py-4 vscroll" id="ParticipantReport">
  <div class="h-100 pb-3 w-100">
    <div class="row mx-0 h-100">
      <div class="col-8 ps-0 pe-3 h-100 position-relative">
        <div class="cardGen cardGenAutoAccord colorGeyGradient w-100" id="accordion5">
          <div class="cardBody singleRowNoimg w-100 p-0">
            <mat-expansion-panel expanded="true" id="testDetails" class="participant-report test-participant">
              <mat-expansion-panel-header class="expansion-panel-header h-8 h2bg"
                style="padding: 1.0vw; height: 3.5vw;">
                <mat-panel-title style="font-size: 140%;color: #000;">
                  <h2 class="h-100">{{ 'bcms.participantReport.participantReport' | translate }} - <span>[ {{service.testParticipantDetails?.TestParticipantName}} ]</span></h2>
                  <p class="position-absolute vmiddleRight forbarStatus"><span>Status </span> <span [class]="(service.testParticipantDetails?.TestWorkflowStatusID == 1)? 'new' : (service.testParticipantDetails?.TestWorkflowStatusID == 3)? 'rinp' : ([5, 6].includes(service.testParticipantDetails?.TestWorkflowStatusID))? 'responded' : ([9, 10].includes(service.testParticipantDetails?.TestWorkflowStatusID))? 'rbo' : (service.testParticipantDetails?.TestWorkflowStatusID == 11)? 'rwc' : 'topapproved'">{{service.testParticipantDetails?.QualifiedStatusName}}</span></p>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <div class="w-100 px-2 py-3">
                <div class="col-12 px-3">
                  <div class="col-12 px-3 py-3">
                    <div class="smallblack text-start fst-italic">{{ 'bcms.participantReport.instructionText' | translate }}</div>
                  </div>
                  <form [formGroup]="participantForm">
                    <div *ngFor="let section of allSections; let i = index" class="">
                      <ng-container [ngSwitch]="section.QuestionsList[0].ComponentID != null">
                        <div *ngSwitchCase="true">
                          <div class="question d-flex justify-content-start mt-4">
                            <span>Q{{i+1}}.</span>
                            <div>
                              <table class="tblContent w-100">
                                <thead>
                                  <tr>
                                    <th class="w-4 text-center">#</th>
                                    <th class="w-20">{{ 'bcms.participantReport.testComponent' | translate }}</th>
                                    <th class="w-40">{{ 'bcms.participantReport.question' | translate }}</th>
                                    <th class="w-16">{{ 'bcms.participantReport.response' | translate }}<sup class="red">*</sup></th>
                                    <th class="w-20">{{ 'bcms.participantReport.comments' | translate }}</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr *ngFor="let question of section.QuestionsList; let j = index">
                                    <td class="text-center align-top">{{j+1}}</td>
                                    <td class="align-top">{{question.Component}}</td>
                                    <td class="align-top">{{question.Question}}</td>
                                    <td class="align-top">
                                      <div class="" id="">
                                        <div class="w-100">
                                          <label class="options" *ngFor="let op of question.Options">
                                            <input type="radio" [name]="'Options' + question.QuestionID" [id]="'Options' + question.QuestionID"
                                              [formControlName]="'Options' + question.QuestionID" [value]="op.OptionID">{{ op.Option }}
                                          </label>
                                          <mat-error *ngIf="submitted && formControls['Options' + question.QuestionID].errors?.['required']">
                                            {{ 'bcms.participantReport.selectAnOption' | translate }}
                                          </mat-error>
                                        </div>
                                      </div>
                                    </td>
                                    <td class="align-top">
                                      <div class="w-100 p-0 mb-2">
                                        <mat-form-field appearance="fill" class="w-100">
                                          <textarea matInput rows="3" [formControlName]="'CommentType' + question.QuestionID" [id]="'CommentType' + question.QuestionID">
                                          </textarea>
                                        </mat-form-field>
                                        <mat-error *ngIf="submitted && formControls['CommentType' + question.QuestionID].errors?.['required']">
                                          {{ 'bcms.participantReport.enterComments' | translate }}
                                        </mat-error>
                                      </div>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="false">
                          <div *ngFor="let question of section.QuestionsList" class="">
                            <div class="question d-flex justify-content-start">
                              <span>Q{{i+1}}.</span>
                              <span><strong *ngIf="section.Section">{{section.Section}}:</strong>
                              {{question.Question}}<sup class="red">*</sup>
                                <span style="font-size: 1.5rem;" class="smallgrey text-start font-italic d-block pt-2">{{question.Notes}}</span>
                              </span>
                            </div>
                            <div class="answer" id="">
                              <div class="d-flex justify-content-start">
                                <div class="w-50" *ngIf="checkPropertyExists(question, 'ControlType')">
                                  <label class="options" *ngFor="let op of question.Options">
                                    <input type="radio" [name]="'Options' + question.QuestionID" [id]="'Options' + question.QuestionID"
                                      [formControlName]="'Options' + question.QuestionID" [value]="op.OptionID" />{{ op.Option }}
                                  </label>
                                  <mat-error *ngIf="submitted && formControls['Options' + question.QuestionID].errors?.['required']">
                                    {{ 'bcms.participantReport.selectAnOption' | translate }}
                                  </mat-error>
                                </div>
                                <div *ngIf="checkPropertyExists(question, 'CommentType')" [class]="question.CommentType == 'ckeditor'? 'w-100':'w-50'">
                                  <ng-container *ngIf="(question.CommentType == 'ckeditor') && intializeCKEditor">
                                    <ckeditor [formControlName]="'CommentType' + question.QuestionID" [id]="'CommentType' + question.QuestionID"
                                      [readOnly]="![1,3,11].includes(service.testParticipantDetails.TestWorkflowStatusID) || (service.testParticipantDetails.BusinessOwnerGUID == service.loggedUser) || service.isBCManager"
                                      [config]="!(![1,3,11].includes(service.testParticipantDetails.TestWorkflowStatusID) || (service.testParticipantDetails.BusinessOwnerGUID == service.loggedUser) || service.isBCManager)? ckeConfig : disabledCkeConfig" [editorUrl]="ckeConfig.ckeditorUrl" debounce="300"></ckeditor>
                                    <mat-error *ngIf="submitted && formControls['CommentType' + question.QuestionID].errors?.['required']">
                                      {{ 'bcms.participantReport.enterComments' | translate }}
                                    </mat-error>
                                  </ng-container>
                                  <ng-container *ngIf="question.CommentType === 'textarea'">
                                    <!-- <label class="w-100 p-0 col-form-label slctLbl text-start">{{ question.CommentLabel }}</label> -->
                                    <div class="w-100 p-0 mb-2">
                                      <mat-form-field appearance="fill" class="w-100">
                                        <textarea matInput rows="3" [formControlName]="'CommentType' + question.QuestionID"
                                          [id]="'CommentType' + question.QuestionID"></textarea>
                                      </mat-form-field>
                                      <mat-error *ngIf="submitted && formControls['CommentType' + question.QuestionID].errors?.['required']">
                                        {{ 'bcms.participantReport.commentsRequired' | translate }}
                                      </mat-error>
                                    </div>
                                  </ng-container>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </form>
                  <label for="" class="w-100 p-0 col-form-label slctLbl text-start mt-4">Q{{allSections?.length + 1}}. {{ 'bcms.participantReport.attachments' | translate }}</label>
                  <div class="w-98 ModaltableContent ModaltableContentBlue ms-5">
                    <div class="w-100 h-14 vscroll" >
                      <table class="w-100 modalTble seablueTble smallTable">
                        <tbody>
                          <tr *ngIf="service?.participateUploadedAttachments?.length == 0" style="height: 5vw;">
                            <td class="w-100 text-center"> {{ 'bcms.participantReport.noAttachments' | translate }} </td>
                          </tr>
                          <tr *ngFor="let file of service.participateUploadedAttachments;index as i">
                            <td class="w-4">{{i+1}}</td>
                            <td class="w-65" (click)="service.downloadFile(file.FileContentID)" [id]="'download'+ file.AttachmentID" class="cursor-pointer"><img src="./assets/images/icon-attachment.svg" >
                              <a class="tblLnk">{{file.AttachmentName}}</a>
                            </td>
                            <td class="w-26">{{formatedDate(file.CreatedDate)}}</td>
                            <td class="w-5" *ngIf="([1,3,11].includes(service.testParticipantDetails?.TestWorkflowStatusID) && !((service.testParticipantDetails?.BusinessOwnerGUID == service.loggedUser) || service.isBCManager))">
                              <button mat-icon-button class="custom-button" style="padding-left: 0.5rem;" (click)="service.deleteUploadParticipantAttachment(file.FileContentID)"
                                [id]="'delete'+ file.FileContentID" alt="delete"><img src="./assets/images/icon-delete-black.svg"></button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="w-100 px-0 text-end py-4" *ngIf="([1,3,11].includes(service.testParticipantDetails?.TestWorkflowStatusID) && !((service.testParticipantDetails?.BusinessOwnerGUID == service.loggedUser) || service.isBCManager))">
                      <div>
                        <button type="button" class="btn btn-primary modalColorBtn modalColorBtnGreen" (click)="openFileUploadPopup()"
                          id="addEvidence"><span class="fw-bold"> <img src="./assets/images/icon-attachment.svg"
                            style="filter: invert(); width: 8%;" alt="">
                          </span> {{ 'bcms.participantReport.attachSupportingDocument' | translate }}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12 px-0 mt-4">
                  <div class="footerBtn text-center">
                    <button class="btn btn-primary modalColorBtn textDetailBtn" id="bottomSave"
                    *ngIf="([1,3,11].includes(service.testParticipantDetails?.TestWorkflowStatusID) && !((service.testParticipantDetails?.BusinessOwnerGUID == service.loggedUser) || service.isBCManager))" (click)="saveReportData(1)">
                      <span class="fw-bold"><img src="./assets/images/icon-application.svg"></span> {{ 'common.save' | translate }}
                    </button>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>
          </div>
        </div>
      </div>
      <div class="col-4 ps-0 pe-3 h-100 position-relative">
        <app-bcms-test-details></app-bcms-test-details>
        <div class="w-100 mt-4 d-flex justify-content-end text-end" id="topSave">
          <div class="me-2">
            <button class="btn btn-primary modalColorBtn textDetailBtn forBoxAction" *ngIf="([1,3,11].includes(service.testParticipantDetails?.TestWorkflowStatusID) && !((service.testParticipantDetails?.BusinessOwnerGUID == service.loggedUser) || service.isBCManager))"
              (click)="saveReportData()">
              <span class="fw-bold"><img src="./assets/images/icon-save.svg" class="saveImg" style="width: 10% !important;"></span> {{ 'common.save' | translate }}
            </button>
          </div>
          <div>
            <button class="btn btn-primary modalColorBtn modalColorBtnGreen textDetailBtn forBoxAction" (click)="submitParticipantReport()" id="submitReview"
            *ngIf="([1,3,11].includes(service.testParticipantDetails?.TestWorkflowStatusID) && !((service.testParticipantDetails?.BusinessOwnerGUID == service.loggedUser) || service.isBCManager))">
              <span class="fw-bold">
                <img src="./assets/images/icon-filecheck.svg">
              </span> {{ 'bcms.participantReport.submitReport' | translate }}
            </button>
          </div>
        </div>
        <mat-error *ngIf="saveerror">{{saveerror}}</mat-error>
        <app-review-comments-history (sucessScrollUP)="sucessScrollUP()"></app-review-comments-history>
      </div>
    </div>
  </div>
</div>
