<div class="modal-header bgSeaGreenGradient text-white allModalHeader">
  <h5 class="modal-title modalh5" id="staticBackdropLabel">{{parent.testMode != 'Update'? ('bcms.create.scheduleTitle' | translate) : ('bcms.create.updateTitle' | translate)}}</h5>
  <button type="button" mat-icon-button class="close customClose example-icon" (click)="resetForm()" mat-dialog-close aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<form [formGroup]="defineBCMSTestForm">
  <div class="modal-body greyModalBody vscroll" style="height: 56vh;">
    <div class="row mx-3">
      <div class="col-6 ps-0 pe-5">
        <div class="row mx-0">
          <div class="col-12 px-0">
            <label for="testTitle" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.testTitle' | translate }} <sup
                class="red">*</sup></label>
            <mat-form-field appearance="fill" class="w-100" *ngIf="!defineBCMSTestForm.disabled">
              <input matInput formControlName="testTitle" [placeholder]="'bcms.create.testTitlePlaceholder' | translate" id="testTitle" (keyup)="checkTestExists($event)"
                (keydown.enter)="$event.preventDefault()" />
            </mat-form-field>
            <mat-form-field class="w-100" class="w-100" *ngIf="defineBCMSTestForm.disabled">
              <textarea matInput id="testTitle" formControlName="testTitle"
                rows="2"></textarea>
            </mat-form-field>
            <mat-error *ngIf="(submitted || f['testTitle'].touched) && f['testTitle'].errors">{{ 'bcms.create.testTitleError' | translate }}</mat-error>
            <mat-error *ngIf="testExists">{{ 'bcms.create.testTitleExists' | translate }}</mat-error>
          </div>
          <div class="col-6 ps-0 pe-2">
            <label for="testType" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.testType' | translate }}<sup
              class="red">*</sup></label>
            <mat-form-field *ngIf="service.infoMaster?.TestTypesList.length > 0" appearance="fill" class="w-100">
              <mat-select matSelectSearch formControlName="testType" id="testType" [placeholder]="'bcms.create.selectTestType' | translate">
                <mat-option *ngFor="let item of service.infoMaster.TestTypesList" [value]="item.TestTypeID"
                  [id]="item.TestTypeID"> {{item.TestType}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-error *ngIf="(submitted || f['testType'].touched) && f['testType'].errors">{{ 'bcms.create.testTypeError' | translate }}</mat-error>
          </div>
          <div class="col-6 ps-2 pe-0">
            <label for="testScenarioTitle" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.testScenarioTitle' | translate }}
              <sup class="red">*</sup></label>
            <mat-form-field appearance="fill" class="w-100" [matTooltip]="checkTitleLength()">
              <input matInput formControlName="testScenarioTitle" [placeholder]="'bcms.create.testScenarioTitlePlaceholder' | translate" id="testScenarioTitle"
                (keydown.enter)="$event.preventDefault()" />
            </mat-form-field>
            <!-- <form class="form-horizontal-scroll">
              <label for="testScenarioTitle" class="w-100 p-0 col-form-label slctLbl text-left mt-4">
                Test Scenario Title
                <sup class="red">*</sup>
              </label>
            
              <mat-form-field appearance="fill" class="w-100">
                <input matInput formControlName="testScenarioTitle" placeholder="Enter Test Scenario Title" id="testScenarioTitle"
                  (keydown.enter)="$event.preventDefault()" />
              </mat-form-field>
            </form> -->
            <!-- <div *ngIf="defineBCMSTestForm.get('testScenarioTitle')?.hasError('maxlength') && submitted">
              <mat-error>More than 200
                characters is not
                allowed</mat-error>
            </div> -->
            <!-- <mat-error *ngIf="defineBCMSTestForm.get('testScenarioTitle')?.hasError('maxlength') && submitted">More than 200 characters is not
              allowed</mat-error> -->
            <!-- <mat-error *ngIf="(submitted || f['testScenarioTitle'].touched) && f['testScenarioTitle'].errors">Enter test
              scenario title</mat-error> -->
              <div *ngIf="(submitted || defineBCMSTestForm.get('testScenarioTitle')?.touched)">
                
                <mat-error *ngIf="defineBCMSTestForm.get('testScenarioTitle')?.hasError('maxlength')">
                  {{ 'bcms.create.maxCharsError' | translate }}
                </mat-error>
              
                <mat-error
                  *ngIf="!defineBCMSTestForm.get('testScenarioTitle')?.hasError('maxlength') && defineBCMSTestForm.get('testScenarioTitle')?.hasError('required')">
                  {{ 'bcms.create.testScenarioTitleError' | translate }}
                </mat-error>
              </div>
          </div>
          <div class="col-12 px-0">
            <label for="testScenarioDes" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.testScenarioDescription' | translate }}<sup class="red">*</sup></label>
            <mat-form-field appearance="fill" class="w-100">
              <textarea matInput formControlName="testScenarioDes" [placeholder]="'bcms.create.testScenarioDescPlaceholder' | translate" rows="4"
                id="testScenarioDes"></textarea>
            </mat-form-field>
            <mat-error *ngIf="(submitted || f['testScenarioDes'].touched) && f['testScenarioDes'].errors">{{ 'bcms.create.testScenarioDescError' | translate }}</mat-error>
          </div>
          <div class="col-12 d-flex align-items-end justify-content-between p-0">
            <span><label for="" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.participants' | translate }} <sup
              class="red">*</sup></label></span>
          </div>
          <div class="w-100 ModaltableContent ModaltableContentBlue" formGroupName="participantGroup">
            <div class="row mx-0" *ngIf="service.infoMaster && service.infoMaster.ParticipantsOptionList?.length > 0">
              <div class="col-12 px-0">
                <label [for]="service.infoMaster.ParticipantsOptionList[0].ParticipantOptionID">
                  <input type="radio" mat-radio-button (change)="selectParticipantsOption(service.infoMaster.ParticipantsOptionList[0].ParticipantOptionID); setBusinessApplications(1)" name="participants"
                    [id]="service.infoMaster.ParticipantsOptionList[0].ParticipantOptionID" aria-label="select" [checked]="parent.testData.ParticipantOptionID == 1"
                    [disabled]="!((parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update'))">
                  {{service.infoMaster.ParticipantsOptionList[0].ParticipantOption}}</label>
              </div>
              <mat-error *ngIf="businessAppUpdated && defineBCMSTestForm.get('participantGroup.participants')?.value == 1"
                style="font-weight: bold;font-size: 0.8vw; color: #318DFA" class="ms-2">
                <img src="./assets/images/colorkit.svg" class="formIconMddl2" style="vertical-align: text-top; height: 0.9vw;" alt="">
                {{ 'bcms.create.businessAppUpdated' | translate }}
              </mat-error>
              <div class="col-xl-5 col-sm-6 ps-0 pe-4 position-relative">
                <div class="position-absolute vhmiddle w-100">
                  <label [for]="service.infoMaster.ParticipantsOptionList[1].ParticipantOptionID">
                    <input type="radio" mat-radio-button (change)="selectParticipantsOption(service.infoMaster.ParticipantsOptionList[1].ParticipantOptionID); setBusinessApplications(2)" name="participants"
                      [id]="service.infoMaster.ParticipantsOptionList[1].ParticipantOptionID" aria-label="select" [checked]="parent.testData.ParticipantOptionID == 2"
                      [disabled]="!((parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update'))">
                    {{service.infoMaster.ParticipantsOptionList[1].ParticipantOption}}</label>
                </div>
              </div>
              <div class="col-xl-4 col-sm-6 ps-4 pe-0">
                <mat-form-field appearance="fill">
                  <input type="text" matInput formControlName="specificSite" [matAutocomplete]="specificSite"  #autoCompleteSpecificSiteInput [ngClass]="defineBCMSTestForm.get('participantGroup.participants')?.value == 2? '':'invisible'"
                    (input)="filterSpecificSites($event)" (keydown.enter)="$event.preventDefault()" id="specificSite" [placeholder]="'bcms.create.selectSitePlaceholder' | translate"/>
                  <mat-autocomplete #specificSite="matAutocomplete">
                    <mat-option *ngFor="let site of filteredSpecificSites" [value]="site.SiteName"
                      (onSelectionChange)="setSpecificSiteID(site, $event); setBusinessApplications(2, $event)" [id]="site.SiteName">
                      {{ site.SiteName }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <mat-error *ngIf="submittedPG && (defineBCMSTestForm.get('participantGroup.participants')?.value == 2) &&
                !defineBCMSTestForm.get('participantGroup.specificSite')?.value">{{ 'bcms.create.selectSitePlaceholder' | translate }}</mat-error>
              </div>
              <mat-error *ngIf="businessAppUpdated && defineBCMSTestForm.get('participantGroup.participants')?.value == 2"
                style="font-weight: bold;font-size: 0.8vw; color: #318DFA" class="ms-2">
                <img src="./assets/images/colorkit.svg" class="formIconMddl2" style="vertical-align: text-top; height: 0.9vw;" alt="">
                {{ 'bcms.create.businessAppUpdated' | translate }}
              </mat-error>
              <div class="col-12 px-0">
                <label [for]="service.infoMaster.ParticipantsOptionList[2].ParticipantOptionID">
                  <input type="radio" mat-radio-button
                    (change)="selectParticipantsOption(service.infoMaster.ParticipantsOptionList[2].ParticipantOptionID); setBusinessApplications(3)"
                    name="participants" [id]="service.infoMaster.ParticipantsOptionList[2].ParticipantOptionID" aria-label="select"
                    [checked]="parent.testData.ParticipantOptionID == 3"
                    [disabled]="!((parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update'))">
                  {{service.infoMaster.ParticipantsOptionList[2].ParticipantOption}}</label>
                <div class="radioFiterBg">
                  <div class="row mx-0">
                    <div class="col-6 px-0 position-relative mb-3">
                      <mat-form-field appearance="fill" class="w-100">
                        <input type="text" matInput formControlName="bussinessFun" [placeholder]="'bcms.create.searchBusinessDepartmentsFunctions' | translate"
                          [matAutocomplete]="businessAuto" #autoCompleteBusinessFunInput (input)="filterBusinessList($event)"
                          (keydown.enter)="$event.preventDefault()" id="bussinessFun" />
                        <span class="position-absolute vmiddleRight iconPositionRight"><i class="fa fa-search"
                            aria-hidden="true"></i></span>
                        <mat-autocomplete #businessAuto="matAutocomplete">
                          <mat-option *ngFor="let business of filteredBusiness" [value]="business.BusinessFunctionsName"
                            (onSelectionChange)="setSelectedBusiness(business); setBusinessApplications(3, $event)" [id]="business.BusinessFunctionsName">
                            {{business.BusinessFunctionsName}}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                      <mat-error *ngIf="submittedPG && (defineBCMSTestForm.get('participantGroup.participants')?.value == 3) &&
                        selectedBusiness?.length == 0">{{ 'bcms.create.selectAtLeastOneBusinessFunction' | translate }}</mat-error>
                    </div>
                    <div _ngcontent-ng-c364572589="" class="col-6 mb-3"></div>
                  </div>
                  <div class="col-6 mb-3"></div>
                  <ng-container *ngIf="(defineBCMSTestForm.get('participantGroup.participants')?.value == 3)">
                    <div *ngFor="let business of selectedBusiness" class="blueCrossFilter position-relative d-inline-block me-2 mb-1 w-auto" [matTooltip]="(business.BusinessFunctionsName)?.length > 50 ? (business.BusinessFunctionsName) : '' ">
                      {{checkLength(business.BusinessFunctionsName)}}
                      <span (click)="removeSelectedBusiness(business); getBusinessAppDisablity()" class="vmiddleRight position-absolute" [id]="'business'+business.BusinessFunctionsID"
                        *ngIf="(parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update')">X</span>
                    </div>
                    <mat-error *ngIf="businessAppUpdated" style="font-weight: bold;font-size: 0.8vw; color: #318DFA"><img src="./assets/images/colorkit.svg" class="formIconMddl2" style="vertical-align: text-top; height: 0.9vw;" alt="">
                      {{ 'bcms.create.businessAppUpdated' | translate }}
                    </mat-error>
                  </ng-container>
                </div>
              </div>
              <div class="col-12 px-0 mt-4">
                <label [for]="service.infoMaster.ParticipantsOptionList[3].ParticipantOptionID">
                  <input type="radio" mat-radio-button (change)="selectParticipantsOption(service.infoMaster.ParticipantsOptionList[3].ParticipantOptionID); setBusinessApplications(4)" name="participants"
                    [id]="service.infoMaster.ParticipantsOptionList[3].ParticipantOptionID" aria-label="select"
                    [checked]="parent.testData.ParticipantOptionID == 4"
                    [disabled]="!((parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update'))">
                  {{service.infoMaster.ParticipantsOptionList[3].ParticipantOption}}</label>
                <div class="radioFiterBg">
                  <div class="row mx-0">
                    <div class="col-6 px-0 position-relative mb-3">
                      <mat-form-field appearance="fill" class="w-100">
                        <input type="text" matInput formControlName="customSites" [placeholder]="'bcms.create.searchSites' | translate" [matAutocomplete]="siteAuto" #autoCompleteCustomSiteInput
                          (input)="filterSitesList($event)" (keydown.enter)="$event.preventDefault()" id="customSites" />
                        <span class="position-absolute vmiddleRight iconPositionRight"><i class="fa fa-search"
                            aria-hidden="true"></i></span>
                        <mat-autocomplete #siteAuto="matAutocomplete">
                          <mat-option *ngFor="let site of filteredSites" [value]="site.SiteName"
                            (onSelectionChange)="setSelectedSite(site); setBusinessApplications(4, $event)" [id]="site.SiteName">
                            {{site.SiteName}}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                      <mat-error *ngIf="submittedPG && (defineBCMSTestForm.get('participantGroup.participants')?.value == 4) &&
                        selectedSites?.length == 0">{{ 'bcms.create.selectAtLeastOneSite' | translate }}</mat-error>
                    </div>
                    <div class="col-6 mb-3"></div>
                    <ng-container *ngIf="(defineBCMSTestForm.get('participantGroup.participants')?.value == 4)">
                      <div *ngFor="let sites of selectedSites"  class="blueCrossFilter position-relative d-inline-block me-2 mb-1 w-auto" [matTooltip]="(sites.SiteName)?.length > 50 ? (sites.SiteName) : '' "  >{{checkLength(sites.SiteName)}}
                        <span (click)="removeSelectedSites(sites); getBusinessAppDisablity()" class="vmiddleRight position-absolute" [id]="'site'+sites.SiteID"
                         *ngIf="(parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update')">X</span></div>
                      <mat-error *ngIf="businessAppUpdated" class="ps-0" style="font-weight: bold;font-size: 0.8vw; color: #318DFA"><img src="./assets/images/colorkit.svg" class="formIconMddl2" style="vertical-align: text-top; height: 0.9vw;" alt="">
                        {{ 'bcms.create.businessAppUpdated' | translate }}
                      </mat-error>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <mat-error *ngIf="(submitted || f1['participants'].touched) && f1['participants'].errors" class="ps-0">{{ 'bcms.create.selectParticipantOption' | translate }}</mat-error>
          <div class="col-12 px-0">
            <label for="plannedTestLimit" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.plannedTestLimitations' | translate }} <sup class="red">*</sup></label>
            <mat-form-field appearance="fill" class="w-100">
              <textarea matInput formControlName="plannedTestLimit" [placeholder]="'bcms.create.enterTestLimitations' | translate" rows="4"
                id="plannedTestLimit"></textarea>
            </mat-form-field>
            <mat-error *ngIf="(submitted || f['plannedTestLimit'].touched) && f['plannedTestLimit'].errors">{{ 'bcms.create.enterTestLimitationsError' | translate }}</mat-error>
          </div>
        </div>
      </div>
      <div class="col-6 ps-5 pe-0">
        <div class="row mx-0">
          <div class="col-6 ps-0 pe-4">
            <label for="" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.plannedStartDate' | translate }} <sup class="red">*</sup></label>
            <div class="row mx-0">
              <div class="col-6 ps-0 pe-2">
                <mat-form-field appearance="fill" (click)="pickerIncStart.open()" class="w-100">
                  <input matInput formControlName="plannedStartDate" [matDatepicker]="pickerIncStart" [placeholder]="'bcms.create.selectStartDate' | translate"
                    (keydown.enter)="$event.preventDefault()" (dateChange)="checkStartTestDateValidation()" id="startBCMSDate">
                  <mat-datepicker-toggle id="startIncDateToggle" matSuffix [for]="pickerIncStart"></mat-datepicker-toggle>
                  <mat-datepicker id="startIncDate" #pickerIncStart></mat-datepicker>
                </mat-form-field>
                <mat-error *ngIf="(submitted || f['plannedStartDate'].touched) && f['plannedStartDate'].errors">{{ 'bcms.create.selectStartDateError' | translate }}</mat-error>
                <mat-error *ngIf="minStartDateError && !endTestDateError">{{ 'bcms.create.startDateFuture' | translate }}</mat-error>
                <mat-error *ngIf="endTestDateError">{{ 'bcms.create.startDateAfterEnd' | translate }}</mat-error>
              </div>
              <div class="col-6 ps-2 pe-0">
                <mat-form-field class="w-100">
                  <input matInput class="time-picker-style" type="time" (blur)="checkStartTestTimeValidation()" formControlName="plannedStartTime" id="timePickerStart">
                </mat-form-field>
                <mat-error *ngIf="(submitted || f['plannedStartTime'].touched) && f['plannedStartTime'].errors">{{ 'bcms.create.selectStartTime' | translate }}</mat-error>
                <mat-error *ngIf="endTestTimeError">{{ 'bcms.create.endTimeLessThanStart' | translate }}</mat-error>
              </div>
            </div>
          </div>
          <div class="col-6 ps-0 pe-4">
            <label for="" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.plannedEndDate' | translate }} <sup
                class="red">*</sup></label>
            <div class="row mx-0">
              <div class="col-6 ps-0 pe-2">
                <mat-form-field appearance="fill" (click)="pickerIncEnd.open()" class="w-100">
                  <input matInput formControlName="plannedEndDate" [matDatepicker]="pickerIncEnd" [placeholder]="'bcms.create.selectEndDate' | translate"
                    (keydown.enter)="$event.preventDefault()" (dateChange)="checkEndTestDateValidation()" id="endBCMSDate">
                  <mat-datepicker-toggle id="plannedEndDate" matSuffix [for]="pickerIncEnd"></mat-datepicker-toggle>
                  <mat-datepicker id="plannedEndDate" #pickerIncEnd></mat-datepicker>
                </mat-form-field>
                <mat-error *ngIf="(submitted || f['plannedEndDate'].touched) && f['plannedEndDate'].errors">{{ 'bcms.create.selectEndDateError' | translate }}</mat-error>
                <mat-error *ngIf="minEndDateError && !endTestDateError">{{ 'bcms.create.endDateFuture' | translate }}</mat-error>
                <mat-error *ngIf="endTestDateError" class="error ml-3"> {{ 'bcms.create.endDateBeforeStart' | translate }}</mat-error>
              </div>
              <div class="col-6 ps-2 pe-0">
                <mat-form-field class="w-100">
                  <input matInput class="time-picker-style" type="time" (blur)="checkEndTestTimeValidation()" formControlName="plannedEndTime"
                    id="timePickerEnd" [placeholder]="'bcms.create.selectEndTime' | translate">
                </mat-form-field>
                <mat-error *ngIf="(submitted || f['plannedEndTime'].touched) && f['plannedEndTime'].errors">{{ 'bcms.create.selectEndTime' | translate }}</mat-error>
                <mat-error *ngIf="endTestTimeError">{{ 'bcms.create.endTimeLessThanStart' | translate }}</mat-error>

              </div>
            </div>
          </div>
          <div class="ps-0">
            <mat-error *ngIf="timeDiffError && !(endTestTimeError || minEndDateError || endTestDateError || minStartDateError)">{{timeDiffError}}</mat-error>
          </div>
          <label for="testObserver" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.testObserver' | translate }}<sup
            class="red">*</sup></label>
          <div class="col-12 p-0 mb-2 position-relative">
            <mat-form-field appearance="fill" class="w-100">
              <input type="text" matInput formControlName="testObserver" [matAutocomplete]="obs" #autoCompleteTestObsInput
                (input)="filterTestObserverList($event)" (keydown.enter)="$event.preventDefault()" id="testObserver" [placeholder]="'bcms.create.searchSelectTestObserver' | translate" />
              <img src="./assets/images/icon-site-bcposition.svg" class="vmiddleRight position-absolute formIconMddl2"
                alt="">
              <mat-autocomplete #obs="matAutocomplete">
                <mat-option *ngFor="let obs of filteredTestObsList" [value]="obs.TestObserverName"
                  (onSelectionChange)="setTestObsGUID(obs)" [id]="obs.TestObserverName">
                  {{ obs.TestObserverName }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <mat-error *ngIf="(submitted || f['testObserver'].touched) && f['testObserver'].errors && !(service.infoMaster.TestObserversList?.length == 0)">{{ 'bcms.create.selectTestObserverError' | translate }}</mat-error>
            <mat-error *ngIf="submitted && isTestObsExists">{{ 'bcms.create.selectDerivedTestObserver' | translate }}</mat-error>
            <mat-error *ngIf="f['testObserver'].touched && service.infoMaster.TestObserversList?.length == 0 && !isTestObsExists && !f['testObserver'].errors">{{ 'bcms.create.noTestObservers' | translate }}</mat-error>
          </div>

          <!--Disruption Scenarios starts-->
          <label for="" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.disruptionScenarios' | translate }}<sup
              class="red">*</sup></label>
          <div class="w-100 ModaltableContent ModaltableContentBlue heightVH-30">
            <div class="w-100 h-80 vscroll" id="disruptionSceScroll">
              <table class="w-100 modalTble seablueTble smallTable addThreat fixedTbleHead" mat-table
                [dataSource]="service.TabledisruptionScenarios">
                <ng-container matColumnDef="Index">
                  <td mat-cell *matCellDef="let row" class="w-5 text-center"> {{row.Index}} </td>
                </ng-container>

                <ng-container matColumnDef="DisruptionScenarioName">
                  <td mat-cell *matCellDef="let row" class="text-left" [ngClass]="(parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update')? 'w-60':'w-80'">
                    <div *ngIf="!row.isEdit">{{row.DisruptionScenarioName}}</div>
                    <div *ngIf="row.isEdit">
                      <mat-form-field appearance="fill" class="w-100">
                        <textarea matInput formControlName="scenario" rows="3" cols="55" id="disruptionScenario" [placeholder]="'bcms.create.enterDisruptionScenario' | translate"
                          (keyup)="onChange($event)" class="text-area"></textarea>
                      </mat-form-field>
                    </div>
                  </td>
                </ng-container>

                <ng-container matColumnDef="Action">
                  <td mat-cell *matCellDef="let row" class="w-20 text-center">
                    <ng-container *ngIf="!row.isEdit">
                      <button mat-icon-button class="material-icons app-toolbar-menu save-button custom-button" [id]="'del'+row.Index"
                        matTooltip="Delete" color="primary" (click)="deleteScenario(row)" [disabled]="blockEdit">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </ng-container>
                    <ng-container *ngIf="row.isEdit">
                      <button mat-icon-button class="material-icons app-toolbar-menu save-button custom-button"
                        matTooltip="Save" color="primary" [id]="'save'+row.Index"
                        [disabled]="!defineBCMSTestForm.get('scenario')?.value?.trim()"
                        (click)="saveScenario(row)"><mat-icon>save</mat-icon>
                      </button>
                      <button mat-icon-button class="material-icons app-toolbar-menu save-button custom-button" [id]="'cancel'+row.Index"
                        matTooltip="cancel" color="primary" (click)="cancelScenario(row)"><mat-icon>close</mat-icon>
                      </button>
                    </ng-container>
                  </td>
                </ng-container>
                <tr mat-row *matRowDef="let row; columns: displayedColumnsDS;"></tr>
                <tr *matNoDataRow>
                  <td [attr.colspan]="displayedColumnsDS.length" style="color: gray;">{{ 'bcms.create.noDisruptionScenarios' | translate }}</td>
                </tr>
              </table>
            </div>
            <div class="w-100 h-20 px-0 text-left py-1">
              <div><button mat-button class="btn btn-primary modalColorBtn modalColorBtnGreen" [disabled]="blockEdit" id="addDS"
                (click)="addDisruptionSce()" *ngIf="(parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update')"
                ><span class="font-weight-bold">+</span> Add</button></div>
            </div>
          </div>
          <mat-error *ngIf="disruptionSceExists" class="ps-0">{{ 'bcms.create.disruptionScenarioExists' | translate }}</mat-error>
          <mat-error *ngIf="(submittedDS && service.TabledisruptionScenarios.data?.length == 0)" class="ps-0">{{ 'bcms.create.atLeastOneDisruptionScenario' | translate }}</mat-error>
          <mat-error *ngIf="(submittedDS && checkDSSave(service.TabledisruptionScenarios.data))" class="ps-0">{{ 'bcms.create.pleaseSaveDisruptionScenario' | translate }}</mat-error>
          <!--Disruption Scenarios ends-->

          <!--Business Applications starts-->
          <label for="" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.businessApplications' | translate }}<sup class="red">*</sup></label>
            <div class="w-100 ModaltableContent ModaltableContentBlue heightVH-30" formGroupName="bussinessApplications">
              <div class="w-100 h-80 vscroll" id="busineesAppScroll">
                <table class="w-100 modalTble seablueTble smallTable addThreat fixedTbleHead" mat-table
                  [dataSource]="service.TableBApplicationTest">
                  <ng-container matColumnDef="Index">
                    <td mat-cell *matCellDef="let row" class="w-5 text-center"> {{row.Index}} </td>
                  </ng-container>

                  <ng-container matColumnDef="ApplicationName">
                    <td mat-cell *matCellDef="let row" class="text-left" [ngClass]="(parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update')? 'w-60':'w-80'">
                      <ng-container *ngIf="!row.isEdit">{{row.BusinessApplicationName}}</ng-container>
                      <ng-container *ngIf="row.isEdit">
                        <mat-form-field appearance="fill" class="w-100">
                          <mat-select matSelectSearch formControlName="applicationId" id="bussinessApps" [placeholder]="'bcms.create.selectBusinessApplications' | translate">
                            <mat-option *ngFor="let application of linkedBussinessApp" [value]="application.BusinessApplicationID" [id]="application.BusinessApplicationID">
                              {{application.BusinessApplicationName}}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </ng-container>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="Action">
                    <td mat-cell *matCellDef="let row" class="w-20 text-center">
                      <ng-container *ngIf="!row.isEdit">
                        <button mat-icon-button class="material-icons app-toolbar-menu save-button custom-button" [id]="'delA'+row.Index"
                          matTooltip="Delete" color="primary" (click)="deleteBusinessApp(row)" [disabled]="blockEditBA">
                          <mat-icon>delete</mat-icon>
                        </button>
                      </ng-container>
                      <ng-container *ngIf="row.isEdit">
                        <button mat-icon-button class="material-icons app-toolbar-menu save-button custom-button"
                          matTooltip="Save" color="primary" [id]="'saveA'+row.Index"
                          [disabled]="!defineBCMSTestForm.controls['bussinessApplications'].value.applicationId"
                          (click)="saveBusinessApp(row)"><mat-icon>save</mat-icon>
                        </button>
                        <button mat-icon-button class="material-icons app-toolbar-menu save-button custom-button" [id]="'cancelA'+row.Index"
                          matTooltip="cancel" color="primary" (click)="cancelBusinessApp(row)"><mat-icon>close</mat-icon>
                        </button>
                      </ng-container>
                    </td>
                  </ng-container>
                  <tr mat-row *matRowDef="let row; columns: displayedColumnsBA;"></tr>
                  <tr *matNoDataRow>
                    <td [attr.colspan]="displayedColumnsBA.length" style="color: gray;">{{ 'bcms.create.noBusinessApplications' | translate }}</td>
                  </tr>
                </table>
              </div>
              <div class="w-100 h-20 px-0 text-left py-1 d-flex align-items-center">
                <div><button mat-button class="btn btn-primary modalColorBtn modalColorBtnGreen" [disabled]="blockEditBA || getBusinessAppDisablity()" id="addBA"
                    (click)="addBusinessApp()" *ngIf="parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update'"
                    ><span class="font-weight-bold">+</span> Add</button></div>
                <div><mat-error *ngIf="!defineBCMSTestForm.get('participantGroup.participants')?.value" class="ps-4">{{ 'bcms.create.selectParticipantsToAddBA' | translate }}</mat-error></div>
              </div>
            </div>
            <mat-error *ngIf="(submittedBA && service.TableBApplicationTest.data?.length == 0)" class="ps-0">{{ 'bcms.create.atLeastOneBusinessApplication' | translate }}</mat-error>
            <mat-error *ngIf="(submittedBA && checkDSSave(service.TableBApplicationTest.data))" class="ps-0">{{ 'bcms.create.pleaseSaveBusinessApplication' | translate }}</mat-error>
            <mat-error *ngIf="(blockEditBA && linkedBussinessApp.length == 0)" class="ps-0">{{ 'bcms.create.noBusinessApplicationAvailable' | translate }}</mat-error>
          <!--Business Applications ends-->

          <div class="col-6 ps-0 pe-2">
            <label for="" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.plannedFinancialImpact' | translate }} <sup class="red">*</sup></label>
            <mat-form-field appearance="fill" class="w-100">
              <input matInput formControlName="plannedFinancialImp" [placeholder]="'bcms.create.enterFinancialImpact' | translate" id="plannedFinancialImp"
                (keydown.enter)="$event.preventDefault()" />
            </mat-form-field>
            <mat-error *ngIf="(submitted || f['plannedFinancialImp'].touched) && f['plannedFinancialImp'].errors">{{ 'bcms.create.enterFinancialImpactError' | translate }}</mat-error>
          </div>
          <div class="col-6 ps-2 pe-0">
            <label for="" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.plannedCustomerImpact' | translate }} <sup class="red">*</sup></label>
            <mat-form-field appearance="fill" class="w-100">
              <input matInput formControlName="PlannedCustomerImp" [placeholder]="'bcms.create.enterCustomerImpact' | translate" id="PlannedCustomerImp"
                (keydown.enter)="$event.preventDefault()" />
            </mat-form-field>
            <mat-error *ngIf="(submitted || f['PlannedCustomerImp'].touched) && f['PlannedCustomerImp'].errors">{{ 'bcms.create.enterCustomerImpactError' | translate }}</mat-error>
          </div>
          <div class="col-12 px-0">
            <label for="" class="w-100 p-0 col-form-label slctLbl text-left mt-4">{{ 'bcms.create.plannedOtherImpact' | translate }}</label>
            <mat-form-field appearance="fill" class="w-100">
              <input matInput formControlName="PlannedOtherImp" [placeholder]="'bcms.create.enterOtherImpact' | translate" id="PlannedOtherImp"
                (keydown.enter)="$event.preventDefault()" />
            </mat-form-field>
          </div>
        </div>
      </div>
    </div>
  </div>
  <mat-error *ngIf="saveerror" style="font-weight: bold;">{{saveerror}}</mat-error>
  <div class="modal-footer modalFooter">
    <button id="cancelBCMTest" class="btn btn-secondary modalCancelBtn me-3" mat-dialog-close (click)="resetForm()">{{ 'common.cancel' | translate }}</button>
    <button id="saveBCMTest" class="btn btn-primary modalColorBtn" (click)="ValidateForm()" *ngIf="parent.testData.TestAssessmentStatusID == 1 || parent.testMode != 'Update'">
      <img  src="./assets/images/icon-application.svg" alt=""> {{ 'common.save' | translate }}</button>
  </div>
</form>
