<div class="tab-content topTabContentBg h-9 mx-3">
  <div class="p-1 text-center position-relative h-100" id="nav-incident-report-fnc" role="tabpanel" style="z-index: 1;"
    aria-labelledby="nav-busitness-fnc">
    <div class="d-flex justify-content-right align-items-center vmiddleRight filterRight">
      <div class="btnGen customize me-4" (click)="openConsolidatedReport()" id="Consolidated">
        <img src="./assets/images/icon-cr.svg" width="20%" alt="Consolidated Report"> Consolidated Report</div>
      <div class="applyFilter addDesktop position-relative text-start me-4" *ngIf="service.isPowerNSiteBCCNSiteAUser && !service.isBCManager">
        <button class="btn btn-dark btnGradient" id="createnewIncident" (click)="addUpdateIncidentReport('Add', {})">Report New Incident</button>
        <span class="position-absolute vmiddleLeft text-white iconPositionLeft"><img
            src="./assets/images/icon-add-desktop.svg"></span>
      </div>
      <div class="d-inline-block position-relative searchInput me-2">
        <input placeholder="Search" class="form-control tblfilter" id="incidentSearch" (keyup)="searchFilter($event)">
        <span class="position-absolute vmiddleRight iconPositionRight"><i class="fa fa-search"
            aria-hidden="true"></i></span>
      </div>
    </div>
    <div class="d-flex justify-content-right align-items-center vmiddleLeft filterLeft">
      <div class="position-relative colorStatus incidentReported me-4" id="incidentReported" (click)="filterIncidentStatus(1)"
        [ngClass]="{ 'active': incidentStatusIds.includes(1)}">
        <span class="vmiddleLeft position-absolute">{{getStatusCount(1)}}</span>
        Incidents<br>Under Review
      </div>

      <div class="position-relative colorStatus inprogress me-4" id="reviewInProgress" (click)="filterIncidentStatus(2)"
        [ngClass]="{ 'active': incidentStatusIds.includes(2)}">
        <span class="vmiddleLeft position-absolute">{{getStatusCount(2)}}</span>
        Reviews<br>Closed
      </div>

      <div class="position-relative colorStatus delayed" id="reviewDelayed" (click)="filterIncidentStatus(3)"
        [ngClass]="{ 'active': incidentStatusIds.includes(3)}">
        <span class="vmiddleLeft position-absolute">{{getStatusCount(3)}}</span>
        Reviews<br>Delayed
      </div>
    </div>
  </div>
</div>

<div class="table-model-bg h-80 px-3 w-100 py-4 vscroll">
  <div class="h-100 pb-3 w-100">
    <div class="row mx-0 h-100">
      <div class="col-12 px-0 h-100">
        <div class="cardGen colorGeyGradient w-100 h-100">
          <div class="cardBody singleRow w-100 h-100">
            <div class="w-100 h-100 px-2 py-3 position-relative">
              <div class="w-100 h-6 position-relative">
                <h2 class="h-100 text-start"><img src="./assets/images/icon-ir.svg" class="headingIcon longBox icokKPI"
                    alt="Incident Reports"> Incident Reports</h2>
              </div>
              <div class="w-100 h-94">
                <section class="w-100 vscroll tableContent h-100" tabindex="0" >
                  <table mat-table [dataSource]="service.TableIncident" class="table-striped"
                    matSort (matSortChange)="sortData($event)" id='incident-report-table'>

                    <ng-container matColumnDef="Index">
                      <th mat-header-cell *matHeaderCellDef class="w-5" style="border-right: 1px solid #fff;"> # </th>
                      <td mat-cell *matCellDef="let row" class="w-5" style="padding-left: 15px;text-align: left;">
                        {{row.Index}} </td>
                    </ng-container>

                    <ng-container matColumnDef="IncidentID">
                      <th mat-header-cell *matHeaderCellDef class="w-10" style="border-right: 1px solid #fff; padding-left: 8px;"> Incident ID </th>
                      <td mat-cell *matCellDef="let row" class="w-10" style="padding-left: 8px;"> {{row.IncidentCode}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Title">
                      <th mat-header-cell *matHeaderCellDef class="w-30" style="border-right: 1px solid #fff; padding-left: 8px;"> Title </th>
                      <td mat-cell *matCellDef="let row" class="w-30" style="padding-left: 8px; position: relative;"><a
                          href="javascript: void(0);" class="tblLnk w-100" style="position: static;" (click)="addUpdateIncidentReport('Edit', row)" [id]="'edit' + row.IncidentCode">
                            {{row.IncidentTitle}}</a>
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="ReportedTime">
                      <th mat-header-cell *matHeaderCellDef class="w-12" style="border-right: 1px solid #fff; padding-left: 8px;"
                        mat-sort-header="FormatedDate"> Reported Date/Time </th>
                      <td mat-cell *matCellDef="let row" class="w-12" style="padding-left: 8px;">
                        {{row.FormatedDate}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Location">
                      <th mat-header-cell *matHeaderCellDef class="w-10" style="border-right: 1px solid #fff; padding-left: 8px;"> Location </th>
                      <td mat-cell *matCellDef="let row" class="w-10" style="padding-left: 8px;">
                        {{row.Location}} </td>
                    </ng-container>

                    <ng-container matColumnDef="NaturalIncident">
                      <th mat-header-cell *matHeaderCellDef class="w-10" style="border-right: 1px solid #fff; padding-left: 8px;"
                        mat-sort-header="IncidentNature"> Nature of Incident </th>
                      <td mat-cell *matCellDef="let row" class="w-10" style="padding-left: 8px;">
                        {{row.IncidentNature}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Classification">
                      <th mat-header-cell *matHeaderCellDef class="w-5" style="border-right: 1px solid #fff; padding-left: 8px;"
                        mat-sort-header="Classification"> Classification </th>
                      <td mat-cell *matCellDef="let row" class="w-5" style="padding-left: 8px;">
                        {{row.Classification}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Status">
                      <th mat-header-cell *matHeaderCellDef class="w-10 text-center" style="border-right: 1px solid #fff; padding-left: 8px;">
                        <mat-form-field appearance="outline" class="mat-outline" style="height: 38px; max-height: 38px;">
                          <mat-label class="status">Status</mat-label>
                          <input matInput [formControl]="statusFilter" id="statusSearch"
                            (keydown.enter)="$event.preventDefault()" />
                          <!-- <mat-icon matSuffix><i class="fa fa-search" aria-hidden="true"></i></mat-icon> -->
                        </mat-form-field>
                      </th>
                      <td mat-cell *matCellDef="let row" class="w-10 text-center" style="padding-left: 8px;">
                        <span class="statusID" [ngClass]="([2].includes(row.ActualStatusID)) ? 'StatusUnderReview' : ([3].includes(row.ActualStatusID)) ? 'statusClosed' : 'statusScheduled'"
                          >{{row.ActualStatus}}</span></td>
                    </ng-container>

                    <ng-container matColumnDef="Action">
                      <th mat-header-cell *matHeaderCellDef class="w-8 text-center" style="border-right: 1px solid #fff; padding-left: 8px;"> </th>
                      <td mat-cell *matCellDef="let row" class="w-8 text-center" style="padding-left: 8px;" [class.text-center]="row.ActualStatusID == 3">
                        <button mat-icon-button class="example-icon custom-button" matTooltip="Edit" (click)="addUpdateIncidentReport('Edit', row)" [id]="'update' + row.IncidentCode"
                          *ngIf="[1,2].includes(row.ActualStatusID)" [disabled]="getViewAccess(row)"> <img src="./assets/images/icon-edit.svg" class="m-0">
                        </button>
                        <button mat-icon-button class="example-icon custom-button" [matTooltip]="!service.isBCManager? 'Submit For Review':'Provide Review Decision'" (click)="!service.isBCManager? service.openSubmitForReview('Submit For Review', row): service.openSubmitForReview('Provide Review Decision', row)" [id]="'submitforReview' + row.IncidentCode"
                          *ngIf="[1,2].includes(row.ActualStatusID)" [disabled]="getViewAccess(row)"> <img src="./assets/images/icon-right-arrow.svg" class="m-0">
                        </button>
                        <button mat-icon-button class="e/xample-icon custom-button" (click)="downloadIncidentConsolidated(row)" *ngIf="row.ActualStatusID == 3"  [id]="'download' + row.IncidentCode" matTooltip="Download Report">
                          <img src="./assets/images/icon-file.svg" class="m-0">
                        </button>
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="table-bg-header-color"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    <tr *matNoDataRow><td [attr.colspan]="displayedColumns.length">No data found.</td></tr>
                  </table>
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
