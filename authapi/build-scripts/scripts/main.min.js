const{src:src,dest:dest,series:series,parallel:parallel}=require("gulp"),plumber=require("gulp-plumber"),browserSync=require("browser-sync").create(),del=require("del"),zip=require("gulp-zip"),terser=require("gulp-terser"),fancyLog=require("fancy-log"),PluginError=require("plugin-error"),concat=require("gulp-concat"),rename=require("gulp-rename"),merge=require("merge-stream"),DIST_ROOT="./../dist/risk-trac-auth-api/",SRC_ROOT="./../";function jsAndAssets(e){const r=src([`./../${e}/**/*.js`],{allowEmpty:!0}).pipe(terser().on("error",e=>fancyLog.error(e))).pipe(dest(`${DIST_ROOT}${e}`)),s=src([`./../${e}/**/*`,`!./../${e}/**/*.js`],{allowEmpty:!0}).pipe(dest(`${DIST_ROOT}${e}`));return merge(r,s)}function moveAuth(){return jsAndAssets("app/auth")}function moveUserManagement(){return jsAndAssets("app/user-management")}function moveConfig(){return src(["./../config/**/*"],{allowEmpty:!0}).pipe(dest(`${DIST_ROOT}config`))}function moveDataAccess(){return jsAndAssets("data-access")}function moveLogFiles(){return src(["./../log-files/**/*"],{allowEmpty:!0}).pipe(dest(`${DIST_ROOT}log-files`))}function moveNodeModules(){return src(["./../node_modules/**/*"],{allowEmpty:!0}).pipe(dest(`${DIST_ROOT}node_modules`))}function moveUtility(){return jsAndAssets("utility")}function moveAppServer(){return src(["./../app-server.js"],{allowEmpty:!0}).pipe(terser().on("error",e=>fancyLog.error(e))).pipe(dest(DIST_ROOT))}function copyJson(){return src(["./../*.json"],{allowEmpty:!0}).pipe(dest(DIST_ROOT))}function moveApiDocs(){return jsAndAssets("api-docs")}const move=parallel(moveAuth,moveUserManagement,moveConfig,moveDataAccess,moveLogFiles,moveNodeModules,moveUtility,moveAppServer,copyJson,moveApiDocs);function clean(){return del([`${DIST_ROOT}**/*`],{force:!0})}function zipDist(){return src(`${DIST_ROOT}**/*`,{allowEmpty:!0}).pipe(zip("risk-trac-auth-api.zip")).pipe(dest(DIST_ROOT))}function bsReload(e){browserSync.reload(),e()}function scripts(){return src("*.js",{allowEmpty:!0}).pipe(plumber({errorHandler:function(e){fancyLog.error(e),this.emit("end")}})).pipe(concat("main.js")).pipe(dest("scripts/")).pipe(rename({suffix:".min"})).pipe(terser().on("error",e=>{fancyLog.error(new PluginError("terser",e).toString()),this.emit("end")})).pipe(dest("scripts/")).pipe(browserSync.stream())}exports.clean=clean,exports.move=move,exports.zip=zipDist,exports.build=series(clean,move),exports.package=series(clean,move,zipDist),exports.scripts=scripts,exports["bs-reload"]=bsReload,exports.default=exports.build;